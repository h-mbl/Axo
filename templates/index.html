<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traducteur de PDF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #fff;
        }
        .btn {
            transition: all 0.3s ease;
        }
        .btn:hover {
            background-color: #333;
        }
        #pdfImage, #translationContent {
            height: calc(100vh - 140px);
            overflow-y: auto;
        }
    </style>
</head>
<body class="flex flex-col h-screen">
    <header class="bg-gray-900 p-4 flex items-center justify-between">
        <form id="uploadForm" method="post" enctype="multipart/form-data" class="flex items-center space-x-4">
            <input type="file" id="fileInput" name="file" accept=".pdf" class="hidden">
            <label for="fileInput" class="btn bg-gray-800 text-white px-4 py-2 rounded cursor-pointer">Choisir un fichier</label>
            <span id="fileName" class="text-gray-300">{{ filename|default('Aucun fichier choisi') }}</span>
            <button type="submit" class="btn bg-gray-800 text-white px-4 py-2 rounded">Charger PDF</button>
        </form>
        <div class="flex items-center space-x-4">
            <span id="pageInfo" class="text-white">Page <span id="currentPage">{{ current_page|default(1) }}</span> / <span id="totalPages">{{ total_pages|default(1) }}</span></span>
            <button id="prevPage" class="btn bg-gray-800 text-white px-3 py-1 rounded">&lt;</button>
            <button id="nextPage" class="btn bg-gray-800 text-white px-3 py-1 rounded">&gt;</button>
            <button id="translateBtn" class="btn bg-green-600 text-white px-4 py-2 rounded">Traduire</button>
        </div>
    </header>

    <main class="flex-grow flex p-4">
        <div id="originalPage" class="w-1/2 p-2">
            <div class="bg-gray-800 rounded-lg flex items-center justify-center h-full">
                {% if filename %}
                    <img id="pdfImage" src="" alt="Page du PDF" class="max-w-full max-h-full">
                {% else %}
                    <p class="text-gray-400">Chargez un PDF pour commencer</p>
                {% endif %}
            </div>
        </div>
        <div id="translatedPage" class="w-1/2 p-2">
            <div id="translationContent" class="bg-gray-800 rounded-lg p-4 h-full overflow-y-auto">
                <p class="text-gray-400">Traduction de la page</p>
            </div>
        </div>
    </main>

    <script>
    $(document).ready(function() {
        let state = {
            currentPage: {{ current_page|default(1) }},
            totalPages: {{ total_pages|default(1) }},
            filename: "{{ filename|default('') }}"
        };

        function updatePageDisplay() {
            $('#prevPage').prop('disabled', state.currentPage === 1);
            $('#nextPage').prop('disabled', state.currentPage === state.totalPages);
            $('#currentPage').text(state.currentPage);
            $('#totalPages').text(state.totalPages);
        }

        function updatePageContent() {
            $.post('/get_page', {
                filename: state.filename,
                page_number: state.currentPage
            }, function(data) {
                $('#pdfImage').attr('src', 'data:image/png;base64,' + data.image);
                updatePageDisplay();
            });
        }

        if (state.filename) {
            updatePageContent();
        }

        $('#prevPage').click(function() {
            if (state.currentPage > 1) {
                state.currentPage--;
                updatePageContent();
            }
        });

        $('#nextPage').click(function() {
            if (state.currentPage < state.totalPages) {
                state.currentPage++;
                updatePageContent();
            }
        });

        $('#translateBtn').click(function() {
            $.ajax({
                url: '/translate',
                method: 'POST',
                data: {
                    filename: state.filename,
                    page_number: state.currentPage
                },
                success: function(response) {
                    $('#translationContent').html(response.translated_text);
                },
                error: function(xhr, status, error) {
                    console.error("Erreur lors de la traduction:", error);
                    $('#translationContent').html("<p>Erreur lors de la traduction. Veuillez réessayer.</p>");
                }
            });
        });

        // Mise à jour du nom de fichier lorsqu'un nouveau fichier est sélectionné
        $('#fileInput').change(function() {
            var fileName = $(this).val().split('\\').pop();
            $('#fileName').text(fileName || 'Aucun fichier choisi');
        });

        // Fonction pour mettre à jour l'état
        function updateState(newState) {
            Object.assign(state, newState);
            updatePageDisplay();
        }

        // Exemple d'utilisation de updateState (à utiliser si nécessaire)
        // updateState({ currentPage: 2, totalPages: 10 });
    });
    </script>
</body>
</html>